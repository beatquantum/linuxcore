# Nginx Error Logging Configuration
# Author: Santosh Pandit, Enhanced by Security Analysis
# Last Update: 07 September 2025
# Purpose: Flag HTTP 4xx and 5xx responses for selective logging to monitor errors.
# Usage: Store in /etc/nginx/conf.d/loggable.conf and use in server blocks with:
#   include /etc/nginx/conf.d/loggable.conf;
#   access_log /path/to/error.log main if=$log_errors;

# Security Goals:
# - Mitigate T1595 (Active Scanning) by logging 4xx errors from reconnaissance attempts.
# - Mitigate T1190 (Exploit Public-Facing Application) by logging 5xx errors from exploits.
# - Mitigate T1189 (Drive-by Compromise) by tracking 4xx errors from blocked malicious requests.
# - Mitigate T1498 (Network Denial of Service) by logging 5xx errors from overload.
# - Mitigate T1071 (Application Layer Protocol) by logging errors from protocol abuse.

# Map HTTP status codes to $log_errors for selective logging.
map $status $log_errors {
    ~^[45] 1; # Log all 4xx (client errors) and 5xx (server errors).
    default 0; # Do not log other status codes (e.g., 2xx, 3xx).
}
